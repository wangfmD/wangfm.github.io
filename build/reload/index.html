<html>
    <head>

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <link href="../static/css/main.css" rel="stylesheet" type="text/css">
        <title>Why Reload?</title>
    </head>
    <body>
        <h2>设定编码的惯例</h2>
<p>当设定python文件编码时</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>


<p>三行搞定，妈妈再也不用担心汉字乱码了！😄</p>
<h2>然而：问题来了</h2>
<p>几个月后的一天，一名女程序员问我：为什么要 reload(sys) ? 😔</p>
<h2>SO: Why reload(sys)</h2>
<h3>1. sys</h3>
<div class="codehilite"><pre>sys 是一个python模块，包含系统对应的功能，比如通过argv获取运行时命令行参数
</pre></div>


<p>具体见http://www.cnblogs.com/diege/archive/2012/10/03/2710776.html <br/></p>
<h3>2. setdefaultencoding 函数</h3>
<div class="codehilite"><pre>setdefaultencoding 是sys模块提供的一个函数，用来<span class="nt">&lt;strong&gt;</span>修改默认编码<span class="nt">&lt;/strong&gt;&lt;br/&gt;</span>
</pre></div>


<h3>3. python 加载模块的过程</h3>
<div class="codehilite"><pre>运行解释器 -&gt; 加载库文件(ex: site.py) -&gt; 加载模块(ex: sys)
</pre></div>


<h3>4. python reload 函数</h3>
<div class="codehilite"><pre>reload 是python内置函数，用于在当前运行时重新加载模块，不会改变先前文件中的模块状态
</pre></div>


<h3>5. reload(sys)</h3>
<p>如果我们尝试运行</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;module&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;setdefaultencoding&#39;</span>
</pre></div>


<p>这又是怎么回事呢？<br/>
当我们导入加载 sys 模块时首先会加载 site.py(/usr/lib/python2.7), 看一下 site.py 的源码：
<img alt="源码" src="http://7xj431.com1.z0.glb.clouddn.com/屏幕快照%202015-09-08%20下午11.17.14.png" /><br/></p>
<p>原来setdefaultencoding函数被site.py删掉啦！至于为什么要删，注释里写了：使用户无法在初始化后改变编码<br/>
而 reload(sys) 则避免了site.py的调用，所以可以使用 setdefaultencoding 函数改变编码<br/></p>
        <div id="disqus_thread"></div>
        <script>
        /**
        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */
        /*
        var disqus_config = function () {
        this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        */
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//neo1218flask.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </body>
</html>
